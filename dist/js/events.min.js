import { dom } from "./domElements.min.js"; import { appState } from "./appState.min.js"; import { verifyAmount, verifyCurrencies } from "./validators.min.js"; import { CurrencyData } from "./currencyData.min.js"; import { showResult, toggleDarkMode } from "./ui.min.js"; let apiKey = "c3eff3653369cb8b3f9f0eaf"; async function fetchConversionData() { var e = await fetch(`https://v6.exchangerate-api.com/v6/${apiKey}/latest/` + appState.baseCurrency), t = await e.json(); return e.ok && t.conversion_rates || handleError(t), t } async function createCurrency() { var e = await fetchConversionData(); return new CurrencyData(e.base_code, e.time_last_update_utc, e.conversion_rates) } async function updateAppState() { var e = await createCurrency(); appState.conversionResult = e.getRate(appState.targetCurrency), appState.finalResult = e.convert(appState.targetCurrency, dom.inputAmount.value) } function handleSuccess() { showResult(), dom.boxEmptyText.textContent = "" } function handleError(e) { throw dom.boxEmptyText.textContent = "Something went wrong. Please try again.", console.error("API error:", e), new Error("Error during currency data fetch") } async function executeConversion() { try { await updateAppState(), handleSuccess() } catch (e) { } } function setupEventListeners() { dom.btnConvert.onclick = handleConvertClick, dom.darkModeButton.onclick = handleDarkModeToggle } function handleConvertClick() { var e = dom.inputFrom(), t = dom.inputTo(); verifyAmount() && verifyCurrencies(e, t) && (appState.baseCurrency = e, appState.targetCurrency = t, executeConversion()) } function handleDarkModeToggle() { toggleDarkMode() } export { executeConversion, setupEventListeners };